#include <iostream>
#include <string>

#define _WINSOCK_DEPRECATED_NO_WARNINGS
#include <WinSock2.h>
#include <Windows.h>
#pragma comment(lib, "Ws2_32.lib")

using namespace std;

#define SRV_ADDR "127.0.0.1"
#define SRV_PORT 666

struct Student {
    char fam[20];
    int vals[4];
};

struct Message {
    int type;
    char message[256];
    Student st;
};

int main() {
    setlocale(LC_ALL, "rus");

    WSADATA ws;
    WSAStartup(MAKEWORD(2, 2), &ws);

    SOCKET s = socket(AF_INET, SOCK_STREAM, 0);

    sockaddr_in addr{};
    addr.sin_family = AF_INET;
    addr.sin_port = htons(SRV_PORT);
    addr.sin_addr.s_addr = inet_addr(SRV_ADDR);

    connect(s, (sockaddr*)&addr, sizeof(addr));

    Message msg;
    cout << "1 - Эхо\n2 - Деканат\n";
    cin >> msg.type;
    cin.ignore();

    if (msg.type == 1) {
        cout << "Введите сообщение: ";
        cin.getline(msg.message, 256);
    } else {
        cout << "Фамилия: ";
        cin.getline(msg.st.fam, 20);
        cout << "4 оценки: ";
        for (int i = 0; i < 4; i++) cin >> msg.st.vals[i];
    }

    send(s, (char*)&msg, sizeof(msg), 0);

    char buf[256];
    recv(s, buf, sizeof(buf), 0);
    cout << "Ответ сервера: " << buf << endl;

    closesocket(s);
    WSACleanup();
}
