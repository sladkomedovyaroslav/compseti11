#include <iostream>
#include <string>
#include <winsock2.h>

#pragma comment(lib, "ws2_32.lib")

int main() {
    WSADATA wsa;
    WSAStartup(MAKEWORD(2, 2), &wsa);

    SOCKET server = socket(AF_INET, SOCK_STREAM, 0);

    sockaddr_in addr{};
    addr.sin_family = AF_INET;
    addr.sin_addr.s_addr = INADDR_ANY;
    addr.sin_port = htons(7070);

    bind(server, (sockaddr*)&addr, sizeof(addr));
    listen(server, 3);

    std::cout << "Server started: http://localhost:7070\n";

    while (true) {
        SOCKET client = accept(server, nullptr, nullptr);

        char buf[1024];
        int bytes = recv(client, buf, sizeof(buf), 0);

        if (bytes > 0) {
            std::string html =
                "<!DOCTYPE html>\n"
                "<html>\n"
                "<head>\n"
                "<meta charset=\"UTF-8\">\n"
                "<title>Hi</title>\n"
                "</head>\n"
                "<body>\n"
                "<h1>hi world</h1>\n"
                "<p>port: 7070</p>\n"
                "</body>\n"
                "</html>";

            std::string response =
                "HTTP/1.1 200 OK\r\n"
                "Content-Type: text/html\r\n"
                "Content-Length: " + std::to_string(html.length()) + "\r\n"
                "Connection: close\r\n"
                "\r\n" + html;

            send(client, response.c_str(), response.size(), 0);
        }

        closesocket(client);
    }

    closesocket(server);
    WSACleanup();
    return 0;
}
